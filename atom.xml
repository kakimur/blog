<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Microsoft Japan Windows Technology Support Blog</title>
  
  <subtitle>日本マイクロソフト Windows Support チームによる、サポート情報 Blog です。</subtitle>
  <link href="https://jpwinsup.github.io/blog/atom.xml" rel="self"/>
  
  <link href="https://jpwinsup.github.io/blog/"/>
  <updated>2020-12-14T02:34:15.530Z</updated>
  <id>https://jpwinsup.github.io/blog/</id>
  
  <author>
    <name>Microsoft Japan Windows Technology Support Team</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Hyper-V Cluster 環境における CSV 空き容量について</title>
    <link href="https://jpwinsup.github.io/blog/2020/12/14/Hyper-V/ConfigurationAndManagement/VMMS-CSV-Aleart/"/>
    <id>https://jpwinsup.github.io/blog/2020/12/14/Hyper-V/ConfigurationAndManagement/VMMS-CSV-Aleart/</id>
    <published>2020-12-14T02:15:00.000Z</published>
    <updated>2020-12-14T02:34:15.530Z</updated>
    
    <content type="html"><![CDATA[<p>みなさん、こんにちは。Windows サポート Storage &amp; High Availability チームの永岡です。本ブログでは Windows Server 2012 R2 の Hyper-V 環境を運用いただく際のボリューム管理 (容量管理) に役立つ情報をご紹介したいと思います。</p><p>Windows Server 2016/2019 については一部動作が異なりますので、後半部分に少しご案内させていただきつつ、ここでは Windows Server 2012 R2 を中心にご紹介します。</p><p>多くの環境で既に Windows Server 2012 R2 Hyper-V Cluster や、スタンドアローンの Hyper-V サーバーを構築いただいている事と思いますが、Hyper-V 機能を利用して仮想マシンを作成・構成した際には、仮想マシン管理サービス (通称 VMMS サービス) が各仮想マシン プロセスを管理する形となります。</p><p>また VMMS サービスの管理対象は、仮想マシン プロセスだけでなく、定期的 (60 秒毎) に仮想マシンで利用されるストレージ領域の容量チェックも実施しています。Hyper-V Cluster の場合には CSV ボリュームがストレージ領域となり、スタンドアローン の場合には、既定もしくは任意で設定いただいた各仮想マシンの .vhdx 置き場がこの領域に該当しますが、もし対象のストレージ領域が 2GB 未満となっていた場合には、以下の警告イベントが出力されます。</p><p><img src="16050-warning.png"><br>またさらに 60 秒間隔のチェック時に、ストレージ領域の残容量が 2GB を下回っており、かつ 200 MB<br>未満の場合には、以下のエラー イベントが出力されて、仮想マシンが一時停止されます。</p><p><img src="16060-Error.png"><br><img src="FCM.png"><br>ここで 1 つ注意が必要ですが、上記のエラーが発生して対象ストレージ領域上で動作する仮想マシンが一時停止した後、該当領域の空き容量が回復した場合にも、仮想マシンは “一時停止” 状態のままとなります。そのため、上記エラーで仮想マシンが一時停止した際には、個別 (手動で) に仮想マシンを “再開” いただく必要があります。</p><p>もちろん、該当ストレージ領域が枯渇しなければ、”一時停止” も、手動操作による “再開” も発生および必要となりませんが、ストレージ領域の容量計算をキッチリと行っている場合においても、バックアップ処理や、想定外の事態により一時的にストレージ容量が枯渇する事も考えられますので、ぜひ運用時にはご注意いただければと思います。</p><p>なお、Windows Server 2016 以降の OS でも同様の定期的な容量チェック処理は VMMS サービスに実装されていますが、上記の 2 GB や 200 MB 未満の一定の閾値については、Hyper-V Container 等のコンポーネントを中心に使用されるように設計が変わっているようです。(Windows Server 2012 R2 のように単純にストレージ領域が200 MB になったので、全ての仮想マシンを “一時停止” するという動作ではありません)</p><p>これは、仮想マシン毎に Critical Error を検知した際の動作ポリシーというものが新しく導入されており、主に仮想ディスクが配置されているストレージ領域の回復性・弾力性 (resiliency) にフォーカスした動作となっているためです。そのため、仮想マシンの .vhdx が配置されたストレージ領域が 200 MB 未満となった場合でも、ストレージとの接続が良好で、仮想マシン プロセス側が動作し続けられる場合には (Critical な問題を検知していない場合においては)、仮想マシンは稼働し続けます。</p><p>また Windows Server 2016 以降の仮想マシンには、通常 “VIRTUAL_MACHINE_CRITICAL_ACTION_PAUSE_RESUME” というポリシーがアサインされますので、Critical エラーを検知した場合の ”基本動作” としては “一時停止” となり、また問題が復旧した際には自動で “再開” という動作ポリシーに変更されています。(※ 基本的にはストレージとの接続状態などに問題が生じた場合が、本ポリシーが活躍するシナリオとなります)</p><p>いかがでしたでしょうか。本投稿が少しでも皆様のお役に立てば幸いです。  </p><p>-参考情報<br><a href="https://docs.microsoft.com/ja-jp/troubleshoot/windows-server/virtualization/virtual-machines-enter-paused-state-low-disk-free">ディスクの空き領域が不足しているため、仮想マシンが一時停止状態になる NotePM</a></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;みなさん、こんにちは。Windows サポート Storage &amp;amp; High Availability チームの永岡です。本ブログでは Windows Server 2012 R2 の Hyper-V 環境を運用いただく際のボリューム管理 (容量管理) に役立つ情報</summary>
      
    
    
    
    <category term="Hyper-V" scheme="https://jpwinsup.github.io/blog/categories/Hyper-V/"/>
    
    <category term="Configuration and Management" scheme="https://jpwinsup.github.io/blog/categories/Hyper-V/Configuration-and-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>個人用ホストプールに割り当ていたユーザーの解除について</title>
    <link href="https://jpwinsup.github.io/blog/2020/12/10/RemoteDesktopService/WVD/remove-a-user-assignment-for-personal-desktop-host-pool/"/>
    <id>https://jpwinsup.github.io/blog/2020/12/10/RemoteDesktopService/WVD/remove-a-user-assignment-for-personal-desktop-host-pool/</id>
    <published>2020-12-10T01:00:00.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは、Windows サポートチームの李です。 </p><p>本記事では、Windows Virtual Desktop 環境で 個人用ホストプールに割り当ていたユーザーの解除についてご紹介いたします。</p><h2 id="発生する事象について"><a href="発生する事象について" class="headerlink" title="発生する事象について"></a>発生する事象について</h2><p>対象ホストプール種類 : 個人用</p><p>個人用 ホストプール で ユーザー を割り当てした後に、解除ができなくなる、<br>あるいは、同一の ホストプール にある別の セッション ホストに同じユーザーの割り当てができません。<br>例えば割り当て後のセッション ホストに対して、Update-AzWvdSessionHost コマンドレットを使ってユーザーの割り当てを変更しようとした場合に<br>以下のようなエラーが発生します。</p><p>参考となるエラーメッセージ：</p><p>【エラー】</p><p>Update-AzWvdSessionHost : ActivityId: &lt; ActivityId &gt; Error: User &lt;アカウント名&gt; can not be assigned to SessionHost &lt;SessionHost 1&gt; because the user is already assigned to this SessionHost &lt;SessionHost 2&gt; in this pool.</p><h2 id="原因について"><a href= 原因について" class="headerlink" title="原因について"></a>原因について</h2><p>個人用 ホストプール はユーザーと セッション ホスト VM を 1 対 1 で紐づけする仕組みであり、<br>一度割り当てを行った個人用セッション ホストは、そのユーザーとの紐づけの解除ができません。</p><p>そのため、ご利用いただくユーザーの変更をしたい場合は、紐づけられたセッション ホストの削除を実施いただく必要がございます。</p><h2 id="対処策について"><a href="対処策について" class="headerlink" title="対処策について"></a>対処策について</h2><p>Azure ポータルサイト上、ホストプールより対象のセッション ホストを削除する必要がございます。</p><p>※ホストプール内の仮想マシンを削除する必要がございません</p><p>対象のセッション ホストを削除した後、あらためてセッション ホストとして再登録するためには、WVD エージェントの再インストール処理が必要となります。<br>手順といたしましては、対象セッション ホストの仮想マシンから下記プログラムをアンインストールし、<br>後述のページに記載のある「Windows Virtual Desktop ホスト プールに仮想マシンを登録する」の手順を実施いただけますようお願い申し上げます。</p><p>■アンインストールするプログラム</p><ul><li>Remote Desktop Agent Boot Loader</li><li>Remote Desktop Services Infrastructure Agent</li><li>Remote Desktop Services Infrastructure Geneva Agent</li></ul><p>■再インストール手順<br>“Windows Virtual Desktop ホスト プールに仮想マシンを登録する”</p><p><a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/create-host-pools-powershell#register-the-virtual-machines-to-the-windows-virtual-desktop-host-pool">https://docs.microsoft.com/ja-jp/azure/virtual-desktop/create-host-pools-powershell#register-the-virtual-machines-to-the-windows-virtual-desktop-host-pool</a></p><p><a id="updatehistory"></a></p><h2 id="更新履歴-Update-History"><a href="#更新履歴-Update-History" class="headerlink" title="更新履歴 - Update History"></a><a href="#updatehistory">更新履歴 - Update History</a></h2><ul><li>2020/12/10 : 本 Blog の公開</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポートチームの李です。 &lt;/p&gt;
&lt;p&gt;本記事では、Windows Virtual Desktop 環境で 個人用ホストプールに割り当ていたユーザーの解除についてご紹介いたし</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Windows Virtual Desktop (WVD)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Windows-Virtual-Desktop-WVD/"/>
    
    
  </entry>
  
  <entry>
    <title>セキュリティ ログの最大サイズをポリシーで配布する際にローカルの値に加算される場合があります</title>
    <link href="https://jpwinsup.github.io/blog/2020/12/04/UserInterfaceAndApps/MaxSizeofEventLogsAdded/"/>
    <id>https://jpwinsup.github.io/blog/2020/12/04/UserInterfaceAndApps/MaxSizeofEventLogsAdded/</id>
    <published>2020-12-04T08:30:00.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。  </p><p>こんにちは。Windows サポートチームの木村です。  </p><p>今回は Windows 10 のグループ ポリシーを用いてイベント ログの最大サイズを設定する際に、最大サイズが適切に設定されずに、ローカルの値に加算される場合があるという問題についてご報告を致します。  </p><h3 id="現象"><a href="#現象" class="headerlink" title="現象"></a>現象</h3><p>ローカル環境でセキュリティ ログの最大サイズを 4 GB 以上に設定した状態で、以下のグループ ポリシーからセキュリティ ログの最大サイズを 4 GB として配布すると、配布した 4 GB 以上の最大サイズが設定されます。  </p><p>[コンピューターの構成] &gt; [ポリシー] &gt; [Windows の設定] &gt; [セキュリティの設定] &gt; [イベント ログ] &gt; [セキュリティ ログの最大サイズ]</p><h4 id="例-1-ローカル値で-6-GB-が設定されている環境に-セキュリティ-ログの最大サイズ-から-4-GB-を設定したとき"><a href="#例-1-ローカル値で-6-GB-が設定されている環境に-セキュリティ-ログの最大サイズ-から-4-GB-を設定したとき" class="headerlink" title="例 1 : ローカル値で 6 GB が設定されている環境に [セキュリティ ログの最大サイズ] から 4 GB を設定したとき"></a>例 1 : ローカル値で 6 GB が設定されている環境に [セキュリティ ログの最大サイズ] から 4 GB を設定したとき</h4><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">期待する動作</td><td align="left">セキュリティ ログの最大サイズが 4 GB になる。</td></tr><tr><td align="left">実際の動作</td><td align="left">セキュリティ ログの最大サイズが 8 GB になる。</td></tr></tbody></table><h4 id="例-2-ローカル値で-8-GB-が設定されている環境に-セキュリティ-ログの最大サイズ-から-4-GB-を設定したとき"><a href="#例-2-ローカル値で-8-GB-が設定されている環境に-セキュリティ-ログの最大サイズ-から-4-GB-を設定したとき" class="headerlink" title="例 2 : ローカル値で 8 GB が設定されている環境に [セキュリティ ログの最大サイズ] から 4 GB を設定したとき"></a>例 2 : ローカル値で 8 GB が設定されている環境に [セキュリティ ログの最大サイズ] から 4 GB を設定したとき</h4><table><thead><tr><th align="left"></th><th align="left"></th></tr></thead><tbody><tr><td align="left">期待する動作</td><td align="left">セキュリティ ログの最大サイズが 4 GB になる。</td></tr><tr><td align="left">実際の動作</td><td align="left">セキュリティ ログの最大サイズが 12 GB になる。</td></tr></tbody></table><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>本現象は、[セキュリティ ログの最大サイズ] のポリシー適用時の処理において、現在のイベント ログの最大サイズに 4 GB 以上の値が設定されていることが考慮されていないために発生する現象となります。</p><h3 id="対処"><a href="#対処" class="headerlink" title="対処"></a>対処</h3><p>[セキュリティ ログの最大サイズ] にポリシーに変わり、以下のグループ ポリシーを用いてセキュリティ ログの最大サイズを設定してください。</p><p>[コンピューターの構成] &gt; [ポリシー] &gt; [管理用テンプレート] &gt; [Windows コンポーネント] &gt; [イベント ログ サービス] &gt; [セキュリティ] &gt; [ログ ファイルの最大サイズ (KB) を指定する]</p><p>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;p&gt;こんにちは。Windows サポートチームの木村です。  &lt;/p&gt;
&lt;p&gt;今回は Windows 10 のグループ ポリシーを用いてイベント ログの最大サイズを設定する際に、最大サイズが適切に設定され</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Server Management" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Server-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>既定のアプリをグループ ポリシーで固定する方法</title>
    <link href="https://jpwinsup.github.io/blog/2020/12/02/UserInterfaceAndApps/how-to-set-gpo-about-DefaultApps/"/>
    <id>https://jpwinsup.github.io/blog/2020/12/02/UserInterfaceAndApps/how-to-set-gpo-about-DefaultApps/</id>
    <published>2020-12-02T10:30:00.000Z</published>
    <updated>2020-12-14T02:34:15.542Z</updated>
    
    <content type="html"><![CDATA[<p>本記事は、マイクロソフト社員によって公開されております。  </p><p>こんにちは、Windows サポートチームの中森です。<br>今回は、ドメイン管理者様に向けて <strong>既定のアプリ</strong> 設定を固定する方法について、ご紹介させていただきます。</p><h2 id="■-既定のアプリが変更される動作について"><a href="#■-既定のアプリが変更される動作について" class="headerlink" title="■ 既定のアプリが変更される動作について"></a>■ 既定のアプリが変更される動作について</h2><p>更新プログラムを適用した際に、<strong>既定のアプリ</strong> が変更されたという経験はございませんでしょうか。  </p><p>Windows 7 や Windows 8、Windows 8.1 から Windows 10 へアップグレードした際、過去のバージョンで推奨とされていたアプリケーションが既定のアプリに選択されている場合は、Windows 10 で推奨されているアプリケーションに既定のアプリを変更します。<br>同様に Windows 10 で機能更新プログラム (FU) や品質更新プログラム (QU) によって推奨されるアプリケーションが更新された際にも、過去のバージョンで推奨とされていたアプリケーションが既定のアプリに選択されている場合は、現在推奨されているアプリケーションに既定のアプリを変更します。</p><p>そのため、Windows 10 で過去に推奨されていたアプリケーション (フォト ビューアー、Windows Media Player 等) を既定のアプリに選択されている環境では、機能更新プログラム (FU) や品質更新プログラム (QU) 適用時に既定のアプリが現在推奨されているアプリケーションに変更される場合がございます。</p><p>しかしながら、お使いいただいている環境によっては既定のアプリの固定が必要な場合もあるかと存じますため、<br>ドメイン環境では <strong>既定のアプリ</strong> の設定を固定するためのグループ ポリシーが用意されておりますので、本情報にてご紹介いたします。<br>(* ワークグループ環境では既定のアプリを固定することはできません。)</p><h2 id="■-グループ-ポリシーによる設定方法"><a href="#■-グループ-ポリシーによる設定方法" class="headerlink" title="■ グループ ポリシーによる設定方法"></a>■ グループ ポリシーによる設定方法</h2><p>Windows 10 を企業でお使いのドメイン管理者様へ向けて、本動作に関するグループ ポリシーをご紹介します。<br>企業内のルールによって、<strong>既定のアプリ</strong>を固定したい場合に、以下のグループ ポリシーが用意されております。<br>ご紹介した動作を含む、<strong>既定のアプリ</strong>の変更を許可しない場合には、この設定をご利用ください。</p><blockquote><p>パス :  [コンピューターの構成] - [管理用テンプレート] - [Windows コンポーネント] - [エクスプローラー]<br>ポリシー : 既定の関連付け構成ファイルの設定<br>値 : 有効<br>既定の関連付け構成ファイル : 作成した関連付け構成ファイル (xml) を指定します （例：\\share\temp\AppAssoc.xml）</p></blockquote><h3 id="関連付けの構成ファイルの作成手順"><a href="#関連付けの構成ファイルの作成手順" class="headerlink" title="関連付けの構成ファイルの作成手順"></a>関連付けの構成ファイルの作成手順</h3><p>ポリシーで設定する<strong>既定の関連付け構成ファイル</strong>は、以下の手順で作成することが可能です。<br>企業内のルールに則って、設定を行った後に出力されますファイル (xml) を上記のポリシーで設定します。</p><ol><li>管理者権限をもつ、任意のアカウントでログオンします。  </li><li>スタート メニューの歯車ボタンから設定アプリを起動します。  </li><li>[アプリ] - [既定のアプリ] 、または、 [ファイルの種類ごとに既定のアプリを選ぶ] から設定を変更します。</li><li>コマンド プロンプトを管理者として起動します。  </li><li>以下のコマンドを実行し、XML ファイルをエクスポートします。<br><strong>Dism /Online /Export-DefaultAppAssociations:&lt;エクスポートするファイルのパス&gt;</strong><br>例) Dism /Online /Export-DefaultAppAssociations:C:\temp\AppAssoc.xml</li></ol><h3 id="注意事項"><a href="#注意事項" class="headerlink" title="注意事項"></a>注意事項</h3><p>グループ ポリシーにより<strong>既定のアプリ</strong>を固定した場合、<br>グループ ポリシーの適用処理が実行されるたびに関連付けが XML ファイルの内容に<br>設定されるため、利用者は任意のアプリケーションを既定のアプリに設定することができなくなります。<br>また、紹介しましたグループ ポリシーは、ドメイン環境でのみ利用可能でございます。</p><ul><li><p>参考情報 : Microsoft Edge を既定のブラウザーに設定する<br><a href="https://docs.microsoft.com/ja-jp/microsoftsearch/set-default-browser">https://docs.microsoft.com/ja-jp/microsoftsearch/set-default-browser</a></p></li><li><p>参考情報 : MDM をご利用の場合<br><a href="https://docs.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-applicationdefaults">https://docs.microsoft.com/ja-jp/windows/client-management/mdm/policy-csp-applicationdefaults</a></p></li></ul><p>本情報の内容 (添付文書、リンク先などを含む) は、作成日時点でのものであり、予告なく変更される場合があります。</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事は、マイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポートチームの中森です。&lt;br&gt;今回は、ドメイン管理者様に向けて &lt;strong&gt;既定のアプリ&lt;/strong&gt; 設定を固定する方法について、ご紹介させていただきます。</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>ユーザーのパスワード変更後に Windows Hello for Business でキャッシュ ログオンできなくなる事象について</title>
    <link href="https://jpwinsup.github.io/blog/2020/11/20/ActiveDirectory/WindowsHello/Unable-to-logon-using-WH4B-cache-after-changing-user-password/"/>
    <id>https://jpwinsup.github.io/blog/2020/11/20/ActiveDirectory/WindowsHello/Unable-to-logon-using-WH4B-cache-after-changing-user-password/</id>
    <published>2020-11-20T02:59:07.000Z</published>
    <updated>2020-12-14T02:34:15.530Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows Commercial Support Directory Services チームです。<br>ハイブリッド Azure AD 参加のデバイスにおいて、ユーザーがパスワードを変更した後に Windows Hello for Business (以下、WHfB) の生体認証や PIN でキャッシュ ログオンできなくなる事象についてご案内いたします。</p><h2 id="発生する事象"><a href="#発生する事象" class="headerlink" title="発生する事象"></a>発生する事象</h2><p>ハイブリッド Azure AD 参加のデバイスにおいて、ユーザーがパスワードを変更した後に、オンプレミス Active Directory と認証できる状態で一度も WHfB でログオンせず、その後オンプレミス Active Directory と接続できない状態で WHfB によるキャッシュ ログオンを試行すると、以下のエラー画面が表示され、ログオンに失敗します。<br>つまり、以下のようなシナリオに合致した場合、本事象が発生します。</p><ol><li>ハイブリッド Azure AD 参加のデバイスにログオンする。  </li><li>ログオンしたユーザーのパスワードを変更する。  </li><li>何らかの要因でハイブリッド Azure AD 参加のデバイスが、オンプレミス Active Directory と通信できない状態となる。  </li><li>オンプレミス Active Directory と通信できない状態で WHfB によるキャッシュ ログオンを行うと、以下のエラーが表示される。<br>「問題が発生し、暗証番号(PIN)を使用できません (状態:0xc000005e、副状態:0x0)。クリックして暗証番号(PIN)をもう一度設定してください。」</li></ol><p>なお、パスワードでのキャッシュ ログオンは成功します。</p><h3 id="ログオン-キャッシュとは"><a href="#ログオン-キャッシュとは" class="headerlink" title="ログオン キャッシュとは"></a>ログオン キャッシュとは</h3><p>ログオン キャッシュとは、ログオンをおこなったコンピューター上に保持されるユーザーのログオン情報となり、Active Directory と認証できないネットワーク環境でも、コンピューターにログオンできるようにすることを目的とした機能になります。2020 年現在サポートされた Windows OS では既定で有効になっており、直近で対話的ログオンをした 10 ログオンまでのログオン キャッシュを保持します。キャッシュ ログオンは、「パスワード」だけでなく、WHfB によるログオンにも対応しております。</p><h2 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h2><p>ユーザーがパスワードを変更する時に行われるログオン キャッシュの無効化処理によって、本事象が発生します。Windows では、ユーザーがパスワード変更をする際に、そのユーザーの 「パスワード変更日時より古いログオン キャッシュ」 をすべて無効化する処理がおこなわれる実装となっております。ユーザーのログオン キャッシュは「パスワード用」のものと、「WHfB 用」のもので、それぞれ別々に保持する実装となっておりますが、上記のキャッシュ無効化処理によって、「パスワード用」 と 「WHfB 用」 の両方のログオン キャッシュがパスワード変更時に無効化されます。　これにより、パスワード変更後に WHfB によるキャッシュ ログオンをしようとすると、ログオンに失敗する事象が発生します。なお、「パスワード用」 のログオン キャッシュは、パスワード変更時に新しいものが生成されるため、パスワードのキャッシュ ログオンは問題なく行えます。</p><h2 id="回避策"><a href="#回避策" class="headerlink" title="回避策"></a>回避策</h2><p>パスワード変更後に、オンプレミス Active Directory と認証できる状態で WHfB でログオンすることで、新しい 「WHfB 用」 のキャッシュが生成され、以降は WHfB によるキャッシュ ログオンが行えるようになります。<br>具体的には以下のような操作により、事象を回避することができます。</p><ol><li>パスワードの変更を行います。</li><li>Ctrl + Alt + Delete キーを押下し、ロックします。</li><li>オンプレミス Active Directory と認証できる状態で WHfB でログオンします。</li></ol><h2 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h2><p>Windows Hello for Business<br><a href="https://docs.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-overview">https://docs.microsoft.com/ja-jp/windows/security/identity-protection/hello-for-business/hello-overview</a></p><p>ハイブリッド Azure AD 参加済みデバイス<br><a href="https://docs.microsoft.com/ja-jp/azure/active-directory/devices/concept-azure-ad-join-hybrid">https://docs.microsoft.com/ja-jp/azure/active-directory/devices/concept-azure-ad-join-hybrid</a></p><p>対話型ログオン: キャッシュする過去のログオン数 (ドメイン コントローラーが使用できない場合)<br><a href="https://docs.microsoft.com/ja-jp/windows/security/threat-protection/security-policy-settings/interactive-logon-number-of-previous-logons-to-cache-in-case-domain-controller-is-not-available">https://docs.microsoft.com/ja-jp/windows/security/threat-protection/security-policy-settings/interactive-logon-number-of-previous-logons-to-cache-in-case-domain-controller-is-not-available</a></p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2020/11/20 : 本ブログの公開</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows Commercial Support Directory Services チームです。&lt;br&gt;ハイブリッド Azure AD 参加のデバイスにおいて、ユーザーがパスワードを変</summary>
      
    
    
    
    <category term="Active Directory" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/"/>
    
    <category term="Windows Hello" scheme="https://jpwinsup.github.io/blog/categories/Active-Directory/Windows-Hello/"/>
    
    
  </entry>
  
  <entry>
    <title>nt!PspSelectNodeForProcess でブルースクリーンが発生する</title>
    <link href="https://jpwinsup.github.io/blog/2020/11/12/Performance/Hang_BSOD/pspselectnodeforprocess/"/>
    <id>https://jpwinsup.github.io/blog/2020/11/12/Performance/Hang_BSOD/pspselectnodeforprocess/</id>
    <published>2020-11-12T04:00:00.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<h1 id="概要"><a href="#概要" class="headerlink" title="概要"></a>概要</h1><p>Windows Server 2016, Windows Server 2019 で運用している大規模サーバーを再起動せずに連続稼働させるとnt!PspSelectNodeForProcess でブルースクリーンが発生することがあります。</p><h1 id="問題の発生要因"><a href="#問題の発生要因" class="headerlink" title="問題の発生要因"></a>問題の発生要因</h1><p>NUMA ノードが複数ある環境でプロセスをどのノードで動かすか選択するために nt!PspSelectNodeForProcess が実行されます。<br>nt!PspSelectNodeForProcess の内部で持っているカウンターがオーバーフローした場合にこの問題が発生します。<br>NUMA の構成ではない環境や定期的に再起動している環境では、このカウンターがオーバーフローしないため、問題は発生しません。<br>NUMA 構成となっているかどうか Sysinternals で公開されている <a href="https://docs.microsoft.com/en-us/sysinternals/downloads/coreinfo">Coreinfo</a> コマンドなどで確認できます。</p><h1 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h1><p>以下のロールアップにて、この問題は修正されました。<br>これ以降のロールアップを適用することで対処してください。</p><p><a href="https://support.microsoft.com/ja-jp/help/4580346">Windows Server 2016</a></p><p><a href="https://support.microsoft.com/ja-jp/help/4580390/windows-10-update-kb4580390">Windows Server 2019</a></p><p><strong>※ 2 年以上連続運用していた環境で実際に問題が発生したことが報告されております。オーバーフローが発生する前に再起動することで本問題は回避可能ですが、nt!PspSelectNodeForProcess の内部で持っているカウンターがいくつになっているのか確認する方法がないため、確実に対処されたい場合にはロールアップを適用してください。</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;概要&quot;&gt;&lt;a href=&quot;#概要&quot; class=&quot;headerlink&quot; title=&quot;概要&quot;&gt;&lt;/a&gt;概要&lt;/h1&gt;&lt;p&gt;Windows Server 2016, Windows Server 2019 で運用している大規模サーバーを再起動せずに連続稼働させると</summary>
      
    
    
    
    <category term="Performance" scheme="https://jpwinsup.github.io/blog/categories/Performance/"/>
    
    <category term="Hang_BSOD" scheme="https://jpwinsup.github.io/blog/categories/Performance/Hang-BSOD/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 10 用のテーマ ファイル作成方法</title>
    <link href="https://jpwinsup.github.io/blog/2020/11/09/UserInterfaceAndApps/how-to-create-themefile-on-Windows10/"/>
    <id>https://jpwinsup.github.io/blog/2020/11/09/UserInterfaceAndApps/how-to-create-themefile-on-Windows10/</id>
    <published>2020-11-09T07:06:13.000Z</published>
    <updated>2020-12-14T02:34:15.538Z</updated>
    
    <content type="html"><![CDATA[<p>本記事は、マイクロソフト社員によって公開されております。  </p><p>こんにちは、Windows サポートチームの佐々木です。</p><p>今回は、Windows 10 でウィンドウのレイアウトの設定変更をご検討いただいている方々のために、Windows 10 向けにテーマ ファイルを作成する方法についてご紹介をさせていただきます。<br>本記事ではグループ ポリシーを使用してテーマ ファイルを配布する手順をご紹介しておりますので、ぜひお試しいただけますと幸いです。</p><h2 id="■-Windows-7-で作成したテーマ-ファイルについて"><a href="#■-Windows-7-で作成したテーマ-ファイルについて" class="headerlink" title="■ Windows 7 で作成したテーマ ファイルについて"></a>■ Windows 7 で作成したテーマ ファイルについて</h2><p>Windows 7 で作成していたテーマファイルを Windows 8 以降の OS に適用した場合、設定が反映されない項目がございます。<br>一例として、Windows 7 のベーシック テーマやハイコントラスト テーマを使用している場合、Windows 7 では個人設定からウィンドウの色やデザインについて様々な変更が可能でしたが、Windows 8 以降の OS ではアクセント カラーとして設定項目が共通化されているため、Windows 7 のテーマ ファイルを Windows 8 以降の OS に適用した場合、同一のレイアウトにはなりません。</p><p>そのため、テーマ ファイルは OS バージョンごとに作成していただくことをお勧めしております。</p><h2 id="■-テーマの設定方法"><a href="#■-テーマの設定方法" class="headerlink" title="■ テーマの設定方法"></a>■ テーマの設定方法</h2><p>Windows 10 では、設定アプリの [個人用設定] からテーマの変更が可能です。</p><p><strong>1. スタートメニューの歯車ボタンをクリックし、設定画面を表示します。</strong><br><strong>2. [個人用設定] をクリックします。</strong><br><strong>3. 左側のメニューに表示されている [テーマ] をクリックします。</strong><br><strong>4. 右側に設定項目が表示されますため、それぞれの項目をカスタマイズします。</strong></p><h2 id="■-テーマ-ファイルの作成方法"><a href="#■-テーマ-ファイルの作成方法" class="headerlink" title="■ テーマ ファイルの作成方法"></a>■ テーマ ファイルの作成方法</h2><p>設定内容を .Theme ファイルとして保存します。  </p><p><strong>1. スタートメニューの歯車ボタンをクリックし、設定画面を表示します。</strong><br><strong>2. [個人用設定] をクリックします。</strong><br><strong>3. 左側のメニューに表示されている [テーマ] をクリックします。</strong><br><strong>4. 右側の設定項目に表示されている “テーマの保存” ボタンをクリックします。<br>**5. テーマの名前を入力し、”保存” ボタンをクリックします。</strong><br><strong>6. 作成したテーマ ファイルは以下の場所に保存されます。</strong></p><p>保存先 : %UserProfile%\AppData\Local\Microsoft\Windows\Themes  </p><h2 id="■-テーマ-ファイルをグループ-ポリシーから配布する方法"><a href="#■-テーマ-ファイルをグループ-ポリシーから配布する方法" class="headerlink" title="■ テーマ ファイルをグループ ポリシーから配布する方法"></a>■ テーマ ファイルをグループ ポリシーから配布する方法</h2><p>作成したテーマ ファイルをグループ ポリシーで配布します。</p><p>本ポリシーは初回ログオン時にのみ適用されますため、新規ユーザーのみ設定が可能となります。<br>既にログオンしているユーザーには反映されない点について、ご注意ください。</p><h3 id="▼ポリシー情報"><a href="#▼ポリシー情報" class="headerlink" title="▼ポリシー情報"></a>▼ポリシー情報</h3><blockquote><p>パス :  [ユーザーの構成] - [管理用テンプレート] - [コントロール パネル] - [個人設定]<br>ポリシー : 特定のテーマを読み込む<br>値 : 有効<br>テーマ ファイルへのパス : 作成したテーマ ファイルを指定します （例：C:\test\Sample.theme）</p></blockquote><p>.theme ファイルのフォーマットに関しては、技術情報を公開しておりますので、ご参照ください。</p><p>参考情報 : Theme File Format<br><a href="https://docs.microsoft.com/en-us/windows/win32/controls/themesfileformat-overview">https://docs.microsoft.com/en-us/windows/win32/controls/themesfileformat-overview</a>  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事は、マイクロソフト社員によって公開されております。  &lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポートチームの佐々木です。&lt;/p&gt;
&lt;p&gt;今回は、Windows 10 でウィンドウのレイアウトの設定変更をご検討いただいている方々のために、Windows 10 向け</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    
  </entry>
  
  <entry>
    <title>Remote Desktop Service 環境で RD セッション ホスト サーバー再起動後に接続できなくなる事象について</title>
    <link href="https://jpwinsup.github.io/blog/2020/11/09/RemoteDesktopService/NotConnectedtoRDSH/"/>
    <id>https://jpwinsup.github.io/blog/2020/11/09/RemoteDesktopService/NotConnectedtoRDSH/</id>
    <published>2020-11-09T05:55:28.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは、Windows サポートチームの吉田です。<br>本記事では、Remote Desktop Service 環境で RD セッション ホスト サーバー再起動後に接続できなくなる事象についての原因と回避策をご紹介いたします。</p><h2 id="発生する事象について"><a href="発生する事象について" class="headerlink" title="発生する事象について"></a>発生する事象について</h2>対象 OS : Windows Server 2012, Windows Server 2012 R2, Windows Server 2016, Windows Server 2019<p>RD 接続ブローカーを利用した Remote Desktop Service 環境において、RD セッション ホスト サーバーを再起動後、コレクション指定してのリモート デスクトップ接続 (RemoteApp 接続含む) に失敗することがあります。</p><h2 id="原因について"><a href= 原因について" class="headerlink" title="原因について"></a>原因について</h2>TermSrv (Remote Desktop Service) サービスが起動する際の初期化処理時に、利用可能な IP アドレスを呼び出す動作が内部で実行されますが、この際に正しいアドレスが列挙されない場合に事象が発生いたします。<p>これは、TermSrv の仕様上の問題となり、TermSrv がシステムからの IP アドレスの一覧情報を取得する際の処理に考慮不足があり、処理中に他のサービスで利用される IP アドレスの情報が増えると正しい情報を得ることができなくなり、今回の事象が発生します。</p><h2 id="対処策について"><a href="対処策について" class="headerlink" title="対処策について"></a>対処策について</h2>TermSrv (Remote Desktop Service) サービスを遅延起動としていただくことが対処策となります。<p>これは、TermSrv (Remote Desktop Service) サービスの起動タイミングが遅れることで、他のサービスで利用される IP アドレスを取得する動作が行われなくためとなります。</p><p>遅延起動としても事象が発生する場合には、TermSrv (Remote Desktop Service) サービスを再起動することで、改めて正しい IP アドレスが取得されるため、事象が改善いたします。</p><p>本問題については、上記の回避策が有効であるため、現行の OS バージョンでの修正は計画されておりません。</p><p>次期 Server OS での修正が計画されております</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは、Windows サポートチームの吉田です。&lt;br&gt;本記事では、Remote Desktop Service 環境で RD セッション ホスト サーバー再起動後に接続できなくなる事象についての原</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Remote Desktop Service (RDS)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Remote-Desktop-Service-RDS/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows 10 バージョン 1809 以降の OS をアップグレードすると証明書が消失する場合がある事象について</title>
    <link href="https://jpwinsup.github.io/blog/2020/11/09/PublicKeyInfrastructure/CertificateManagement/certificates-are-missing-after-in-place-upgrade/"/>
    <id>https://jpwinsup.github.io/blog/2020/11/09/PublicKeyInfrastructure/CertificateManagement/certificates-are-missing-after-in-place-upgrade/</id>
    <published>2020-11-09T00:47:14.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows プラットフォーム サポートです。<br>今回はある特定の条件を満たした場合、OS アップグレード後に証明書が消失するという問題についてご紹介させていただきます。</p><h2 id="発生する事象"><a href="#発生する事象" class="headerlink" title="発生する事象"></a>発生する事象</h2><p>以下の条件をすべて満たす場合、OS のインプレース アップグレード後に、証明書が消失するといった問題が報告されています。</p><ul><li>アップグレード前は 2020 年 9 月 16 日の更新プログラム以降が適用されている状態となっている。(2020 年 9 月 16 日の更新プログラム以降が対象となりますので、2020 年 10 月 13 日の更新プログラムが適用されている状態も対象となります。)</li><li>Windows 10 バージョン 1809 からバージョン 2004 のコンピューターを、より上位の OS バージョンにアップグレードする。</li><li>OS アップグレードの際に用いるインストール メディアや機能更新プログラムに関して、更新プログラムの適用状態が 2020 年 9 月 16 日の更新プログラムよりも前の状態となっている。(例として、初期のリリースのインストール メディアを利用してアップグレードしたり、”updated Aug 2020” と記載されているような、更新プログラムが適用されているインストール メディアではあるものの、2020 年 9 月 16 日の更新プログラムよりも前のものしか適用されていないメディアを利用してアップグレードすることを指します。)</li></ul><p>例えば、以下のようなシナリオでインプレース アップグレードする場合、上記の条件にすべて合致することとなりますので、本問題が発生します。</p><p>例 1:<br>2020 年 9 月 16 日の更新プログラムが適用されている Windows 10 バージョン 1909 を、更新プログラムが適用されていない Windows 10 バージョン 2004 のインストール メディアを利用してインプレース アップグレードする。</p><p>例 2:<br>2020 年 10 月 13 日の更新プログラムが適用されている Windows 10 バージョン 1809 から、2020 年 8 月 11 日の更新プログラムが適用されている (2020 年 9 月 16 日の更新プログラム以降は適用されていない) Windows 10 バージョン 1909 のインストール メディアを利用してインプレース アップグレードする。</p><p>※ ISO ファイルなどのインストール メディアを利用してアップグレードする場合以外にも、WSUS や SCCM をご利用の場合においても、上記の条件をすべて満たす場合は本問題が発生する可能性があります。<br>※ 後述の参考資料には、前述の 3 点目の条件として、”2020 年 10 月 13 日以降の更新プログラムが含まれていないメディアやインストレーション ソースを利用した場合に、本事象が発生する” と記載されていますが、正確には “2020 年 9 月 16 日以降の更新プログラム” になります。2020 年 9 月 16 日の更新プログラムはプレビューであることから、後述の参考資料には “2020 年 10 月 13 日以降の更新プログラム” と記載されていますが、技術的には dism コマンドを用いてプレビューの更新プログラムをメディアに組み込むこともできますので、本ブログでは 3 点目の条件として “2020 年 9 月 16 日の更新プログラム” と表記しております。</p><h2 id="本問題による影響"><a href="#本問題による影響" class="headerlink" title="本問題による影響"></a>本問題による影響</h2><p>本問題が発生することにより、具体的に以下のような影響が発生することが報告されております。</p><ul><li>ユーザーおよびコンピューターの [個人] ストアに格納されている証明書が消失する。</li><li>[信頼されたルート証明機関] ストアに格納されているルート証明書が消失する。</li><li>Azure AD に参加できていない状態になってしまう。</li><li>EFS を用いて暗号化されたファイルが開けなくなる。</li><li>その他、証明書が消失することによって、その証明書を利用していた VPN や無線 LAN において問題が発生する。</li></ul><h2 id="対処策"><a href="#対処策" class="headerlink" title="対処策"></a>対処策</h2><p>以下のいずれかの対処を実施することにより、本事象が発生せずに OS アップグレードを実施することができます。</p><ul><li>動的更新 (Dynamic Update) が実施できる状況でアップグレードする。(動的更新とは、OS のセットアップ中に重要なドライバー、コンポーネントおよびセットアップの機能強化を取得し、適用する更新プログラムのことです。)</li><li>2020 年 9 月 16 日の更新プログラム以降が適用された状態のインストール メディアや機能更新プログラムを用いてアップグレードを実施する。</li><li>アップグレード前の状態において、2020 年 9 月 16 日以降の更新プログラムをアンインストールしてから、OS アップグレードを実施する。</li></ul><h2 id="各アップグレード-シナリオごとの対処策"><a href="#各アップグレード-シナリオごとの対処策" class="headerlink" title="各アップグレード シナリオごとの対処策"></a>各アップグレード シナリオごとの対処策</h2><p>本問題が発生しないようにするためには、前述のいずれかの対処策を実施する必要があります。<br>ですが、例えば WSUS を利用している場合、結局のところ具体的にどのようにすれば、前述の対処策を実施できることになるのかをご確認されたいお客様もいらっしゃるかもしれません。<br>以下では WSUS 環境と SCCM 環境のそれぞれにおきまして、具体的にどのようにすれば対処策を実施できるのかをご紹介いたします。</p><h3 id="■-WSUS-を用いてアップグレードする場合"><a href="#■-WSUS-を用いてアップグレードする場合" class="headerlink" title="■ WSUS を用いてアップグレードする場合"></a>■ WSUS を用いてアップグレードする場合</h3><h4 id="□-WSUS-環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合"><a href="#□-WSUS-環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合" class="headerlink" title="□ WSUS 環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合"></a>□ WSUS 環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合</h4><p>アップグレード対象のコンピューターがインターネットに接続でき、かつ動的更新も実施できる場合は、対象のコンピューターでアップグレード処理を実施している際に動的更新が行われ、自動的に本問題への対処が実施されます。<br>そのため、WSUS 側では OS をアップグレードするための機能更新プログラムを承認するだけで問題ありません。</p><h4 id="□-WSUS-環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新ができない場合"><a href="#□-WSUS-環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新ができない場合" class="headerlink" title="□ WSUS 環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新ができない場合"></a>□ WSUS 環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新ができない場合</h4><p>環境によっては、以下のような理由でインターネットに接続して動的更新が実施できない場合もあると存じます。</p><ul><li>そもそもインターネットに接続できない環境である。</li><li>インターネットには接続できるものの、意図的に動的更新が無効化されている。</li><li>インターネットには接続できるものの、後述の動的更新を実施するための条件を満たしていない。</li></ul><p>その場合は、以下の 2 通りの対処方法が存在します。</p><p>- 2020 年 11 月 10 日にリリースされた新しい機能更新プログラムを利用する方法<br>2020 年 11 月 10 日に 2020 年 10 月 13 日の更新プログラムが適用された状態の機能更新プログラムがリリースされましたので、そちらをご利用いただいてアップグレードをお願いいたします。<br>なお、この 2020 年 10 月 13 日の更新プログラムが適用された状態の機能更新プログラムについては、Windows 10 バージョン 1909 からバージョン 20H2 に関してリリースされており、バージョン 1903 に関してはリリースされておりません。</p><p>- [Windows 10 GDR-DU] を利用する方法<br>WSUS 側の [オプション] - [製品と分類] から、[Windows 10 GDR-DU] をオンにし、同期を実施します。<br>すると、[2020-10 Dynamic Cumulative Update for Windows 10 Version XXXX for XXX-based Systems (KBXXXXXXX)] という更新プログラムが表示されるようになります。<br>機能更新プログラムと併せて、上記の更新プログラムも承認した上で OS をアップグレードすることにより、インターネット経由で動的更新が実施できない場合でも、本事象に対処できます。<br>なお、現時点ではバージョン 1903 からバージョン 2004 に関しては、上記の更新プログラムが公開されていますが、バージョン 20H2 に関しては公開されておりません。</p><h3 id="■-SCCM-を用いてアップグレードする場合"><a href="#■-SCCM-を用いてアップグレードする場合" class="headerlink" title="■ SCCM を用いてアップグレードする場合"></a>■ SCCM を用いてアップグレードする場合</h3><h4 id="□-SCCM-環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合"><a href="#□-SCCM-環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合" class="headerlink" title="□ SCCM 環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合"></a>□ SCCM 環境でアップグレード対象のコンピューターがインターネットに接続でき、動的更新もできる場合</h4><p>アップグレード対象のコンピューターがインターネットに接続でき、かつ動的更新も実施できる場合は、対象のコンピューターでアップグレード処理を実施している際に動的更新が行われ、自動的に本問題への対処が実施されます。<br>そのため、SCCM 側では特に何も意識することなく対処が可能です。</p><h4 id="□-SCCM-環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新できない場合"><a href="#□-SCCM-環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新できない場合" class="headerlink" title="□ SCCM 環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新できない場合"></a>□ SCCM 環境でアップグレード対象のコンピューターが、何らかの理由でインターネットに接続して動的更新できない場合</h4><p>前述の WSUS 環境の場合と同様に、何らかの理由でインターネットに接続して動的更新が実施できない場合もあると存じます。<br>その場合は、以下の 2 通りの対処方法が存在します。</p><p>- 2020 年 11 月 10 日にリリースされた新しい機能更新プログラムを利用する方法<br>前述の WSUS 環境の場合と同様に、2020 年 11 月 10 日にリリースされた、2020 年 10 月 13 日の更新プログラムが適用された状態の機能更新プログラムを利用してアップグレードを実施します。</p><p>- タスク シーケンスで 2020 年 9 月 16 日以降の更新プログラムが適用されたインストール メディアを利用する方法<br>タスク シーケンスを用いてアップグレード対象のコンピューターにインストール メディアを配布し、OS をアップグレードします。<br>この時、使用するインストール メディアとして、2020 年 9 月 16 日以降の更新プログラムが適用されているものを利用します。</p><p>2020 年 9 月 16 日以降の更新プログラムが適用されたインストール メディアの入手方法についてですが、ボリューム ライセンスをご利用のお客様に関しましては、VLSC より “updated Oct 2020” と記載された ISO ファイルをダウンロードいただくことによって入手することができます。<br>Visual Studio サブスクリプションをご契約いただいておりますお客様につきましては、Visual Studio サブスクリプションのダウンロード サイトより、”updated Oct 2020” と記載された ISO ファイルをダウンロードいただくことによって入手することができます。</p><p>もし、お手元にインストール メディアをお持ちの場合には、以下の方法でお持ちの ISO ファイルに対して 2020 年 9 月 16 日以降の更新プログラムを組み込むことができます。</p><p>Windows イメージへの更新の追加<br><a href="https://docs.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/servicing-the-image-with-windows-updates-sxs">https://docs.microsoft.com/ja-jp/windows-hardware/manufacture/desktop/servicing-the-image-with-windows-updates-sxs</a></p><h2 id="消失した証明書の復旧方法"><a href="#消失した証明書の復旧方法" class="headerlink" title="消失した証明書の復旧方法"></a>消失した証明書の復旧方法</h2><p>以下の手順を実施して Windows をアップグレード前のバージョンに戻すことにより、本問題によって消失してしまった証明書を復旧することができます。</p><ol><li>スタート メニューから歯車のアイコンをクリックし、[Windows の設定] を開きます。</li><li>[更新とセキュリティ] をクリックします。</li><li>左ペインの [回復] をクリックします。</li><li>[前のバージョンの Windows 10 に戻す] の欄の [開始する] をクリックします。</li><li>以前のバージョンに戻す理由を入力し、[次へ] をクリックします。</li><li>“アップデートをチェックしますか?” と表示されたら、[行わない] をクリックします。</li><li>“知っておくべきこと” が表示されたら、[次へ] をクリックします。</li><li>“ロックアウトされないようにご注意ください” が表示されたら、[次へ] をクリックします。</li><li>[以前のビルドに復元する] をクリックします。</li></ol><h2 id="動的更新を実施する際の条件"><a href="#動的更新を実施する際の条件" class="headerlink" title="動的更新を実施する際の条件"></a>動的更新を実施する際の条件</h2><p>インターネットに接続して動的更新を実施するためには、インターネットに接続できる状況であるという前提に加えて、以下の 2 点のエンドポイントに接続できることが条件となっております。</p><ul><li><a href="https://fe3.delivery.mp.microsoft.com/">https://fe3.delivery.mp.microsoft.com:443</a>  </li><li><a href="http://tlu.dl.delivery.mp.microsoft.com/">http://tlu.dl.delivery.mp.microsoft.com</a></li></ul><p>そのため、インターネットに接続できる環境であったとしても、厳密には上記のエンドポイントに対しても通信ができる状態でないと動的更新が実施できませんので、ご留意いただけますと幸いです。</p><h2 id="参考資料"><a href="#参考資料" class="headerlink" title="参考資料"></a>参考資料</h2><p>Windows 10, version 2004 and Windows Server, version 2004<br><a href="https://docs.microsoft.com/en-us/windows/release-information/status-windows-10-2004#1513msgdesc">https://docs.microsoft.com/en-us/windows/release-information/status-windows-10-2004#1513msgdesc</a></p><p>Windows 10 バージョン 1809 および Windows Server 2019 の更新履歴<br><a href="https://support.microsoft.com/ja-jp/help/4464619">https://support.microsoft.com/ja-jp/help/4464619</a></p><p>Windows 10 バージョン 1903 の更新履歴<br><a href="https://support.microsoft.com/ja-jp/help/4498140">https://support.microsoft.com/ja-jp/help/4498140</a></p><p>Windows 10 バージョン 1909 の更新履歴<br><a href="https://support.microsoft.com/ja-jp/help/4529964">https://support.microsoft.com/ja-jp/help/4529964</a></p><p>Windows 10 バージョン 2004 の更新履歴<br><a href="https://support.microsoft.com/ja-jp/help/4555932">https://support.microsoft.com/ja-jp/help/4555932</a></p><p>Windows 10 バージョン 20H2 の更新履歴<br><a href="https://support.microsoft.com/en-us/help/4581839">https://support.microsoft.com/en-us/help/4581839</a></p><p>Windows 10 を以前のバージョンの Windows 10 に戻す方法について<br><a href="https://social.technet.microsoft.com/Forums/ja-JP/514994cc-17d8-4b7d-befc-07b10c765c7e">https://social.technet.microsoft.com/Forums/ja-JP/514994cc-17d8-4b7d-befc-07b10c765c7e</a></p><p>Windows 10 の動的更新のメリット<br><a href="https://blogs.windows.com/japan/2019/12/03/the-benefits-of-windows-10-dynamic-update/">https://blogs.windows.com/japan/2019/12/03/the-benefits-of-windows-10-dynamic-update/</a></p><h2 id="更新履歴"><a href="#更新履歴" class="headerlink" title="更新履歴"></a>更新履歴</h2><p>2020/11/9: 本ブログの公開<br>2020/11/12: 対処方法に関する情報を更新</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows プラットフォーム サポートです。&lt;br&gt;今回はある特定の条件を満たした場合、OS アップグレード後に証明書が消失するという問題についてご紹介させていただきます。&lt;/p&gt;
&lt;h2</summary>
      
    
    
    
    <category term="Public Key Infrastructure" scheme="https://jpwinsup.github.io/blog/categories/Public-Key-Infrastructure/"/>
    
    <category term="Certificate Management" scheme="https://jpwinsup.github.io/blog/categories/Public-Key-Infrastructure/Certificate-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>WVD および FSLogix 関連の各種公開情報</title>
    <link href="https://jpwinsup.github.io/blog/2020/11/05/RemoteDesktopService/WVD/wvd-fslogix-useful-links/"/>
    <id>https://jpwinsup.github.io/blog/2020/11/05/RemoteDesktopService/WVD/wvd-fslogix-useful-links/</id>
    <published>2020-11-05T14:26:09.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><p>こんにちは。Windows プラットフォーム サポートの玉井です。</p><p>2019 年に Windows Virtual Desktop (WVD) を公開して以降、多くのお客様よりWVD および FSLogix に関するご質問をお寄せいただいております。</p><p>本ブログ記事では弊社サポートにお問合せいただいた際に、回答内容の中でご案内することが多い WVD および FSLogix に関する技術文書のリンクをまとめています。</p><p>参考情報として用いていただければ幸いです。</p><ul><li><a href="#wvd-latest">WVD 最新情報</a></li><li><a href="#wvd-related">WVD 関連情報</a></li><li><a href="#wvd-architecture">WVD 設計・構築時ガイドライン</a></li><li><a href="#wvd-faq">WVD に関する FAQ</a></li><li><a href="#fslogix-latest">FSLogix 最新情報</a></li><li><a href="#fslogix-related">FSLogix 関連情報</a></li><li><a href="#updatehistory">更新履歴</a></li></ul><p><a id="wvd-latest"></a></p><h2 id="WVD-最新情報"><a href="#WVD-最新情報" class="headerlink" title="WVD 最新情報"></a><a href="#wvd-latest">WVD 最新情報</a></h2><h4 id="キャンペーン企画"><a href="#キャンペーン企画" class="headerlink" title="キャンペーン企画"></a>キャンペーン企画</h4><p>最短 1 か月でリモートワーク環境構築！</p><p><a href="https://www.microsoft.com/ja-jp/biz/cloud-platform/campaign-3vdi-wvd.aspx">https://www.microsoft.com/ja-jp/biz/cloud-platform/campaign-3vdi-wvd.aspx</a></p><h4 id="WVD-のロードマップを知りたい"><a href="#WVD-のロードマップを知りたい" class="headerlink" title="WVD のロードマップを知りたい"></a>WVD のロードマップを知りたい</h4><p>WVD ロードマップ</p><p><a href="https://aka.ms/wvdroadmap">https://aka.ms/wvdroadmap</a></p><h4 id="WVD-最新情報を知りたい"><a href="#WVD-最新情報を知りたい" class="headerlink" title="WVD 最新情報を知りたい"></a>WVD 最新情報を知りたい</h4><p>WVD Update on Microsoft Tech Community</p><p><a href="https://aka.ms/wvdupdate">https://aka.ms/wvdupdate</a></p><p>Azure Blog</p><p><a href="https://azure.microsoft.com/ja-jp/updates/?category=windows-virtual-desktop">https://azure.microsoft.com/ja-jp/updates/?category=windows-virtual-desktop</a></p><p><a id="wvd-related"></a></p><h2 id="WVD-関連情報"><a href="#WVD-関連情報" class="headerlink" title="WVD 関連情報"></a><a href="#wvd-related">WVD 関連情報</a></h2><h4 id="WVD-の製品へのフィードバックをしたい"><a href="#WVD-の製品へのフィードバックをしたい" class="headerlink" title="WVD の製品へのフィードバックをしたい"></a>WVD の製品へのフィードバックをしたい</h4><p>WVD UserVoice</p><p><a href="https://aka.ms/wvdfbk">https://aka.ms/wvdfbk</a></p><h4 id="WVD-のコミュニティに参加したい"><a href="#WVD-のコミュニティに参加したい" class="headerlink" title="WVD のコミュニティに参加したい"></a>WVD のコミュニティに参加したい</h4><p>Microsoft Tech Community - Windows Virtual Desktop</p><p><a href="https://aka.ms/wvdtc">https://aka.ms/wvdtc</a></p><h4 id="WVDのアーキテクチャの例を知りたい"><a href="#WVDのアーキテクチャの例を知りたい" class="headerlink" title="WVDのアーキテクチャの例を知りたい"></a>WVDのアーキテクチャの例を知りたい</h4><p>エンタープライズ向け Windows Virtual Desktop</p><p><a href="https://docs.microsoft.com/ja-jp/azure/architecture/example-scenario/wvd/windows-virtual-desktop">https://docs.microsoft.com/ja-jp/azure/architecture/example-scenario/wvd/windows-virtual-desktop</a></p><h4 id="Microsoft-Learn-で-WVD-を触ってみたい"><a href="#Microsoft-Learn-で-WVD-を触ってみたい" class="headerlink" title="Microsoft Learn で WVD を触ってみたい"></a>Microsoft Learn で WVD を触ってみたい</h4><p>Windows Virtual Desktop を使用して Azure からリモート デスクトップおよびリモート アプリを提供する</p><p><a href="https://docs.microsoft.com/ja-jp/learn/paths/m365-wvd/">https://docs.microsoft.com/ja-jp/learn/paths/m365-wvd/</a></p><h4 id="WVD製品紹介"><a href="#WVD製品紹介" class="headerlink" title="WVD製品紹介"></a>WVD製品紹介</h4><p>どこからでも安全なリモート デスクトップ エクスペリエンスを実現</p><p><a href="https://azure.microsoft.com/ja-jp/services/virtual-desktop/">https://azure.microsoft.com/ja-jp/services/virtual-desktop/</a></p><h4 id="Windows-Virtual-Desktop-の価格"><a href="#Windows-Virtual-Desktop-の価格" class="headerlink" title="Windows Virtual Desktop の価格"></a>Windows Virtual Desktop の価格</h4><p>Azure で提供される、最適な仮想デスクトップのエクスペリエンス</p><p><a href="https://azure.microsoft.com/ja-jp/pricing/details/virtual-desktop/">https://azure.microsoft.com/ja-jp/pricing/details/virtual-desktop/</a></p><h4 id="WVD-の公式ドキュメント"><a href="#WVD-の公式ドキュメント" class="headerlink" title="WVD の公式ドキュメント"></a>WVD の公式ドキュメント</h4><p>Windows Virtual Desktop のドキュメント</p><p><a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/">https://docs.microsoft.com/ja-jp/azure/virtual-desktop/</a></p><p><a id="wvd-architecture"></a></p><h2 id="WVD-設計・構築時ガイドライン"><a href="#WVD-設計・構築時ガイドライン" class="headerlink" title="WVD 設計・構築時ガイドライン"></a><a href="#wvd-architecture">WVD 設計・構築時ガイドライン</a></h2><h4 id="構築時の考慮事項・制限事項"><a href="#構築時の考慮事項・制限事項" class="headerlink" title="構築時の考慮事項・制限事項"></a>構築時の考慮事項・制限事項</h4><p>エンタープライズ向け Windows Virtual Desktop - 考慮事項</p><p><a href="https://docs.microsoft.com/ja-jp/azure/architecture/example-scenario/wvd/windows-virtual-desktop#considerations">https://docs.microsoft.com/ja-jp/azure/architecture/example-scenario/wvd/windows-virtual-desktop#considerations</a></p><p>ネットワークのガイドライン</p><p><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/network-guidance?context=/azure/virtual-desktop/context/context">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/network-guidance?context=/azure/virtual-desktop/context/context</a></p><p>仮想マシンのサイズ設定のガイドライン</p><p><a href="https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/virtual-machine-recs">https://docs.microsoft.com/ja-jp/windows-server/remote/remote-desktop-services/virtual-machine-recs</a></p><p>事業継続とディザスター リカバリー プランを設定する</p><p><a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/disaster-recovery">https://docs.microsoft.com/ja-jp/azure/virtual-desktop/disaster-recovery</a></p><p>安全な URL リスト</p><p>※WVD セッションホスト・WVD クライアントからそれぞれ許可する必要がある URL リスト</p><p><a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/safe-url-list">https://docs.microsoft.com/ja-jp/azure/virtual-desktop/safe-url-list</a></p><p>Azure Firewall を使用して Window Virtual Desktop のデプロイを保護する</p><p><a href="https://docs.microsoft.com/ja-jp/azure/firewall/protect-windows-virtual-desktop">https://docs.microsoft.com/ja-jp/azure/firewall/protect-windows-virtual-desktop</a></p><p>Azure Firewall を使用してセキュアでコスト効果の高い Windows Virtual Desktop 保護を実現</p><p><a href="https://azure.microsoft.com/ja-jp/blog/use-azure-firewall-for-secure-and-cost-effective-windows-virtual-desktop-protection/">https://azure.microsoft.com/ja-jp/blog/use-azure-firewall-for-secure-and-cost-effective-windows-virtual-desktop-protection/</a></p><p><a id="wvd-faq"></a></p><h2 id="WVD-に関する-FAQ"><a href="#WVD-に関する-FAQ" class="headerlink" title="WVD に関する FAQ"></a><a href="#wvd-faq">WVD に関する FAQ</a></h2><p>Windows 10 Enterprise マルチセッションに関する FAQ</p><p><a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/windows-10-multisession-faq">https://docs.microsoft.com/ja-jp/azure/virtual-desktop/windows-10-multisession-faq</a></p><p>Windows Virtual Desktop の FAQ</p><p><a href="https://docs.microsoft.com/ja-jp/azure/virtual-desktop/faq">https://docs.microsoft.com/ja-jp/azure/virtual-desktop/faq</a></p><p><a id="fslogix-latest"></a></p><h2 id="FSLogix-最新情報"><a href="#FSLogix-最新情報" class="headerlink" title="FSLogix 最新情報"></a><a href="#fslogix-latest">FSLogix 最新情報</a></h2><h4 id="リリースノート"><a href="#リリースノート" class="headerlink" title="リリースノート"></a>リリースノート</h4><p>リリース 2009 (2.9.7621.30127)</p><p><a href="https://social.msdn.microsoft.com/Forums/en-US/defe5828-fba4-4715-a68c-0e4d83eefa6b/release-notes-for-fslogix-apps-release-2009-29762130127?forum=FSLogix">https://social.msdn.microsoft.com/Forums/en-US/defe5828-fba4-4715-a68c-0e4d83eefa6b/release-notes-for-fslogix-apps-release-2009-29762130127?forum=FSLogix</a></p><p>リリース 2004 (2.9.7349.30108)</p><p><a href="https://social.msdn.microsoft.com/Forums/en-US/e82cb114-2459-4a99-bcbf-50b7d314b5b9/release-notes-for-fslogix-apps-release-2004-29734930108?forum=FSLogix">https://social.msdn.microsoft.com/Forums/en-US/e82cb114-2459-4a99-bcbf-50b7d314b5b9/release-notes-for-fslogix-apps-release-2004-29734930108?forum=FSLogix</a></p><p>リリース 1909  (2.9.7237.48865) ホットフィックス</p><p><a href="https://social.msdn.microsoft.com/Forums/en-US/dcd86de9-e092-49b4-b2a1-20e1943bbdc5/release-notes-for-fslogix-apps-1909-hf01-29723748865-hotfix">https://social.msdn.microsoft.com/Forums/en-US/dcd86de9-e092-49b4-b2a1-20e1943bbdc5/release-notes-for-fslogix-apps-1909-hf01-29723748865-hotfix</a></p><p>リリース 1907 (2.9.7117.27413) </p><p><a href="https://social.msdn.microsoft.com/Forums/en-US/53263a51-856f-4e64-bc0e-a689d4cc5a8b/release-notes-for-1907-build-29711727413?forum=FSLogix">https://social.msdn.microsoft.com/Forums/en-US/53263a51-856f-4e64-bc0e-a689d4cc5a8b/release-notes-for-1907-build-29711727413?forum=FSLogix</a></p><p><a id="fslogix-related"></a></p><h2 id="FSLogix-関連情報"><a href="#FSLogix-関連情報" class="headerlink" title="FSLogix 関連情報"></a><a href="#fslogix-related">FSLogix 関連情報</a></h2><h4 id="FSLogix-の公式ドキュメント"><a href="#FSLogix-の公式ドキュメント" class="headerlink" title="FSLogix の公式ドキュメント"></a>FSLogix の公式ドキュメント</h4><p>FSLogix documentation</p><p><a href="https://docs.microsoft.com/en-us/fslogix/">https://docs.microsoft.com/en-us/fslogix/</a></p><h4 id="FSLogix-の公式フォーラム"><a href="#FSLogix-の公式フォーラム" class="headerlink" title="FSLogix の公式フォーラム"></a>FSLogix の公式フォーラム</h4><p>FSLogix Forums</p><p><a href="https://social.msdn.microsoft.com/Forums/windowsserver/en-US/home?forum=FSLogix">https://social.msdn.microsoft.com/Forums/windowsserver/en-US/home?forum=FSLogix</a></p><h4 id="FSLogix-の製品へのフィードバックをしたい"><a href="#FSLogix-の製品へのフィードバックをしたい" class="headerlink" title="FSLogix の製品へのフィードバックをしたい"></a>FSLogix の製品へのフィードバックをしたい</h4><p>FSLogix UserVoice</p><p><a href="https://windowsvirtualdesktop.uservoice.com/forums/921289-fslogix">https://windowsvirtualdesktop.uservoice.com/forums/921289-fslogix</a></p><h4 id="FSLogix-の公式フォーラム-FAQs"><a href="#FSLogix-の公式フォーラム-FAQs" class="headerlink" title="FSLogix の公式フォーラム FAQs"></a>FSLogix の公式フォーラム FAQs</h4><p>FSLogix Forum FAQs</p><p><a href="https://social.msdn.microsoft.com/Forums/en-US/ac19d7b7-fbea-4e73-b6a1-8a0fecf00a14/fslogix-forum-faqs">https://social.msdn.microsoft.com/Forums/en-US/ac19d7b7-fbea-4e73-b6a1-8a0fecf00a14/fslogix-forum-faqs</a></p><p><a id="updatehistory"></a></p><h2 id="更新履歴-Update-History"><a href="#更新履歴-Update-History" class="headerlink" title="更新履歴 - Update History"></a><a href="#updatehistory">更新履歴 - Update History</a></h2><ul><li>2020/11/05 : 本 Blog の公開</li><li>2020/11/24 : FSLogix リリース 2009 のリリースノート追記</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;p&gt;こんにちは。Windows プラットフォーム サポートの玉井です。&lt;/p&gt;
&lt;p&gt;2019 年に Windows Virtual Desktop (WVD) を公開して以降、多くのお客様よりWVD および</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Windows Virtual Desktop (WVD)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Windows-Virtual-Desktop-WVD/"/>
    
    
  </entry>
  
  <entry>
    <title>オフライン ライセンス アプリをダウンロードする方法</title>
    <link href="https://jpwinsup.github.io/blog/2020/10/19/UserInterfaceAndApps/MicrosoftStore/DownloadOfflinePackage/"/>
    <id>https://jpwinsup.github.io/blog/2020/10/19/UserInterfaceAndApps/MicrosoftStore/DownloadOfflinePackage/</id>
    <published>2020-10-19T15:00:00.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>本記事は 2019 年 3 月 6 日に公開された <a href="https://social.technet.microsoft.com/Forums/ja-JP/244a5f4c-5d8a-485f-8d30-768f17dd57bd/12458125011252112452125311249712483124651254012472123982083725">オフラインパッケージの入手方法およびストアアプリのインストール手順について</a> の最新版になります。<br>最新の更新情報は、本内容をご参照ください。</p></blockquote><hr><h2 id="オフライン-ライセンス-アプリについて"><a href="#オフライン-ライセンス-アプリについて" class="headerlink" title="オフライン ライセンス アプリについて"></a>オフライン ライセンス アプリについて</h2><p>こんにちは、Windows サポートチームの國重です。   </p><p>今回は、<a href="https://businessstore.microsoft.com/ja-jp/store">Microsoft Store for Business</a>、<a href="https://educationstore.microsoft.com/ja-jp/store">Microsoft Store for Education</a> からオフライン ライセンス アプリをダウンロードする手順をご紹介いたします。</p><p><a href="https://businessstore.microsoft.com/ja-jp/store">Microsoft Store for Business</a>、<a href="https://educationstore.microsoft.com/ja-jp/store">Microsoft Store for Education</a> ではプライベート ストアと呼ばれる組織専用のストア ページを作成することで、任意のアプリケーションを配布することが可能になります。<br>しかしながら、プライベート ストアを利用するためには、ユーザーが Microsoft Store に Azure Active Directory、Office 365 アカウントでサイン インする必要があるため、以下のような状況ではプライベート ストアによるアプリケーションが展開できません。</p><ul><li>ネットワークに接続されておらず、Microsoft Store サービスにアクセスできない。</li><li>Azure Active Directory、Office 365 アカウントでログオンできない。</li></ul><p>このようなシナリオでは、<a href="https://businessstore.microsoft.com/ja-jp/store">Microsoft Store for Business</a>、<a href="https://educationstore.microsoft.com/ja-jp/store">Microsoft Store for Education</a> からオフライン ライセンス アプリを取得することでアプリケーションの展開が可能になります。</p><h2 id="オフライン-ライセンス-アプリの二次配布について"><a href="#オフライン-ライセンス-アプリの二次配布について" class="headerlink" title="オフライン ライセンス アプリの二次配布について"></a>オフライン ライセンス アプリの二次配布について</h2><p>オフライン ライセンスは組織のネットワーク内でのみ配布が可能です。<br>こちらは <a href="https://docs.microsoft.com/ja-jp/microsoft-store/acquire-apps-microsoft-store-for-business">ビジネスおよび教育機関向け Microsoft Store のアプリを入手する</a> にも記載しています。</p><h2 id="オフライン-ライセンス-アプリの公開可否について"><a href="#オフライン-ライセンス-アプリの公開可否について" class="headerlink" title="オフライン ライセンス アプリの公開可否について"></a>オフライン ライセンス アプリの公開可否について</h2><p>オフライン ライセンス アプリは全アプリケーションで用意されているものではなく、アプリケーションの発行元にて公開可否の設定が可能となっております。<br>Microsoft Store 上でオフライン ライセンス アプリが公開されていないアプリケーションにつきましては、アプリケーションの発行元にお問い合わせいただきますようお願い申し上げます。</p><h2 id="オフライン-ライセンス-アプリをダウンロードする方法"><a href="#オフライン-ライセンス-アプリをダウンロードする方法" class="headerlink" title="オフライン ライセンス アプリをダウンロードする方法"></a>オフライン ライセンス アプリをダウンロードする方法</h2><p>オフライン ライセンス アプリはグローバル管理者、または、購入者ロールが割り当てられたアカウントから取得が可能になります。</p><h4 id="グローバル管理者アカウントの確認方法"><a href="#グローバル管理者アカウントの確認方法" class="headerlink" title="グローバル管理者アカウントの確認方法"></a>グローバル管理者アカウントの確認方法</h4><ol><li><a href="https://portal.azure.com/">Azure Portal</a> にアクセスし、サイン インします。</li><li>[Azure Active Directory] – [ロールと管理者] – [グローバル管理者] をクリックします。</li><li>グローバル管理者アカウントのアカウントが表示されます。</li></ol><h4 id="購入者ロールの割り当て方法"><a href="#購入者ロールの割り当て方法" class="headerlink" title="購入者ロールの割り当て方法"></a>購入者ロールの割り当て方法</h4><ol><li><a href="https://businessstore.microsoft.com/ja-jp/store">Microsoft Store for Business</a>、<a href="https://educationstore.microsoft.com/ja-jp/store">Microsoft Store for Education</a> にアクセスし、グローバル管理者でサイン インします。</li><li>[管理] タブをクリックします。</li><li>[アクセス許可] を選択します。</li><li>組織内の Azure Active Directory、Office 365 アカウントを入力し、”購入者”  にチェックを入れて [保存] ボタンをクリックします。</li></ol><h4 id="オフライン-ライセンス-アプリのダウンロード"><a href="#オフライン-ライセンス-アプリのダウンロード" class="headerlink" title="オフライン ライセンス アプリのダウンロード"></a>オフライン ライセンス アプリのダウンロード</h4><ol><li><a href="https://businessstore.microsoft.com/ja-jp/store">Microsoft Store for Business</a>、<a href="https://educationstore.microsoft.com/ja-jp/store">Microsoft Store for Education</a> にグローバル管理者、または購入者ロールが割り当てられたアカウントでサインインします。</li><li>[管理] - [設定] - [ショッピング エクスペリエンス] から [オフラインアプリを表示する] を “オン” に設定します。</li><li>画面右上の検索ボックスに ダウンロードしたいストアアプリ名を入力し検索します。</li><li>検索結果から対象のアプリを選択します。</li><li>[ライセンスの種類] を “オフライン” に変更し、[アプリを入手する] をクリックします。<br>(“オフライン” が表示されていないアプリケーションはオフライン ライセンス アプリが非公開となっております。  )</li></ol><p><img src="./download1.png"></p><ol start="6"><li>購入確認画面が表示された後、ボタンが [管理] に変わりますので、[管理] ボタンをクリックします。</li></ol><p><img src="./download2.png"></p><ol start="7"><li>[オフラインで使用するパッケージのダウンロード] にてインストール対象の環境に合わせた設定を選択し、[ダウンロード] をクリックします。</li></ol><p><img src="./download3.png"></p><ol start="8"><li>「パッケージの詳細」以下にある“オフラインで使用するパッケージ”、“必要なフレームワーク” のダウンロード、ならびに “ライセンスの生成” を全て実施します。</li></ol><p><img src="./download4.png"></p><h2 id="オフライン-ライセンス-アプリのインストール"><a href="#オフライン-ライセンス-アプリのインストール" class="headerlink" title="オフライン ライセンス アプリのインストール"></a>オフライン ライセンス アプリのインストール</h2><ol><li>インストールするアカウントでログオンします。</li><li>Windows PowerShell を実行します。</li><li>Add-AppxPackage コマンドレットを実行し、アプリケーションをインストールします。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Add-AppxPackage -Path &lt;パッケージ（.AppxBundle 形式）のファイルパス&gt; &#96;</span><br><span class="line">    -DependencyPath @( &#96;</span><br><span class="line">        &lt;フレームワーク(.Appx 形式)のファイルパス&gt;, &#96;</span><br><span class="line">        &lt;フレームワーク(.Appx 形式)のファイルパス&gt;, &#96;</span><br><span class="line">        &lt;フレームワーク(.Appx 形式)のファイルパス&gt; &#96;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">* -DependencyPath にはカンマ区切りで必要なフレームワークをすべて指定します。</span><br></pre></td></tr></table></figure><p>&lt;実行例&gt;</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Add-AppxPackage -Path &quot;C:\temp\Microsoft.WindowsCalculator_2020.2008.2.0_neutral___8wekyb3d8bbwe.AppxBundle&quot; &#96;</span><br><span class="line">    -DependencyPath @(&#96;</span><br><span class="line">       &quot;C:\temp\Microsoft.UI.Xaml.2.4_2.42007.9001.0_x64__8wekyb3d8bbwe.Appx&quot;, &#96;</span><br><span class="line">       &quot;C:\temp\Microsoft.VCLibs.140.00_14.0.29231.0_x64__8wekyb3d8bbwe.Appx&quot; &#96;</span><br><span class="line">        )</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt;本記事は 2019 年 3 月 6 日に公開された &lt;a href=&quot;https://social.technet.microsoft.com/Forums/ja-JP/244a5f4c-5d8a-485f-8d30-768f17dd57bd/12</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Microsoft Store" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Microsoft-Store/"/>
    
    
  </entry>
  
  <entry>
    <title>%Systemroot%\System32\LogFiles\Sum フォルダ内に作成される文字化けしたファイルについて</title>
    <link href="https://jpwinsup.github.io/blog/2020/10/13/UserInterfaceAndApps/ServerManagement/garbled_file_on_sum_folder/"/>
    <id>https://jpwinsup.github.io/blog/2020/10/13/UserInterfaceAndApps/ServerManagement/garbled_file_on_sum_folder/</id>
    <published>2020-10-13T07:19:49.000Z</published>
    <updated>2020-12-14T02:34:15.538Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><blockquote><p>本記事は 2018 年 9 月 4 日に <a href="https://docs.microsoft.com/en-us/archive/blogs/askcorejp/garbled-files-in-sum-folder">%Systemroot%\System32\LogFiles\Sum フォルダ内に作成される文字化けしたファイルについて</a> に公開された記事、および 2019 年 3 月 7 日に <a href="https://social.technet.microsoft.com/Forums/ja-JP/2c0fa8d9-6726-42ea-a3eb-b6ae8179783f/systemrootsystem32logfilessum?forum=Wcsupportja">%Systemroot%\System32\LogFiles\Sum フォルダ内に作成される文字化けしたファイルについて</a> に公開された記事の最新版になります。</p></blockquote><p>こんにちは。Windows プラットフォームサポートの丸山です。</p><p>今回は、%Systemroot%\System32\LogFiles\Sum フォルダ内に作成される文字化けしたファイルについて、ご紹介させていただきます。</p><h2 id="■-発生する事象について"><a href="#■-発生する事象について" class="headerlink" title="■ 発生する事象について"></a>■ 発生する事象について</h2><p>Windows Server 2016 環境、および Windows Server 2019 環境において、%Systemroot%\System32\LogFiles\Sum フォルダ内に文字化けしたファイルが作成されることがあります。</p><p>文字化けしたファイルが作成されている例：<img src="/blog/2020/10/13/UserInterfaceAndApps/ServerManagement/garbled_file_on_sum_folder/1412030.png" class=""></p><p>この文字化けしたファイルは、User Access Logging Service (UALSVC) により生成されております。</p><p>また、この事象は UALSVC による初回の情報収集が実施される前にサービスが再起動されたとき、作成されるファイルであることがわかっております。</p><p>UALSVC は既定の設定でサービスを起動してから 24 時間が経過したタイミングで初回の情報収集が行われます。</p><p>このため、初回の情報収集が行われるまでに複数回、UALSVC の再起動が行われました場合には、都度、文字化けしたファイルが生成されます。</p><p>なお、以下の KB でご紹介しているような手順にて UALSVC のログの削除を行いました場合にも、次回の情報収集が行われるまでに UALSVC を再起動すると、文字化けしたファイルが生成されることがわかっています。</p><p>Windows Server 2012 : イベントソース “ESENT” 、ID “327” “326” の イベントが大量発生する。<br><a href="https://support.microsoft.com/ja-jp/help/2900773">https://support.microsoft.com/ja-jp/help/2900773</a></p><h2 id="■-対処策について"><a href="#■-対処策について" class="headerlink" title="■ 対処策について"></a>■ 対処策について</h2><p>本件に対処するためには、以下の記載しております更新プログラムを適用の上、必要に応じて、文字化けしたファイルを手動で削除してください。</p><h3 id="1-更新プログラムの適用について"><a href="#1-更新プログラムの適用について" class="headerlink" title="1. 更新プログラムの適用について"></a>1. 更新プログラムの適用について</h3><p>各 OS バージョン毎に、以下の KB 番号よりも新しい更新プログラムを適用してください。</p><h4 id="Windows-Server-2016"><a href="#Windows-Server-2016" class="headerlink" title="Windows Server 2016"></a>Windows Server 2016</h4><p>KB4499177 以降の更新プログラムを適用してください。</p><p>2019 年 5 月 24 日 — KB4499177 (OS ビルド 14393.2999)<br><a href="https://support.microsoft.com/ja-jp/help/4499177/windows-10-update-kb4499177">https://support.microsoft.com/ja-jp/help/4499177/windows-10-update-kb4499177</a></p><h4 id="Windows-Server-2019"><a href="#Windows-Server-2019" class="headerlink" title="Windows Server 2019"></a>Windows Server 2019</h4><p>KB4505658 以降の更新プログラムを適用してください。</p><p>2019 年 7 月 23 日 — KB4505658 (OS ビルド 17763.652)<br><a href="https://support.microsoft.com/ja-jp/help/4505658/windows-10-update-kb4505658">https://support.microsoft.com/ja-jp/help/4505658/windows-10-update-kb4505658</a></p><h3 id="2-文字化けしたファイルの削除について"><a href="#2-文字化けしたファイルの削除について" class="headerlink" title="2. 文字化けしたファイルの削除について"></a>2. 文字化けしたファイルの削除について</h3><p>文字化けしたファイルが作成された場合、そのまま放置していただいてもシステムの動作に影響はございませんが、不要なファイルでございますので、文字化けしたファイルはお手数ですが、手動で削除してください。</p><h2 id="■-更新履歴-Update-History"><a href="#■-更新履歴-Update-History" class="headerlink" title="■ 更新履歴 - Update History"></a>■ 更新履歴 - Update History</h2><ul><li>2018/09/04 : 本 Blog の公開</li><li>2020/10/13 : 更新プログラムによる対処策を追加</li></ul><p>—<br>丸山 健一 (マルヤマ ケンイチ)<br>Windows プラットフォームサポート担当<br>日本マイクロソフト株式会社  </p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本記事は 2018 年 9 月 4 日に &lt;a href=&quot;https://docs.microsoft.com/en-us/archive/blogs/askcorejp/ga</summary>
      
    
    
    
    <category term="User Interface and Apps" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/"/>
    
    <category term="Server Management" scheme="https://jpwinsup.github.io/blog/categories/User-Interface-and-Apps/Server-Management/"/>
    
    
  </entry>
  
  <entry>
    <title>Windows Server 2016 および 2019 における Windows ファイアウォール規則の肥大化について</title>
    <link href="https://jpwinsup.github.io/blog/2020/10/08/RemoteDesktopService/wnf-leak-issue-on-windows-server-2016-and-windows-server-2019/"/>
    <id>https://jpwinsup.github.io/blog/2020/10/08/RemoteDesktopService/wnf-leak-issue-on-windows-server-2016-and-windows-server-2019/</id>
    <published>2020-10-08T10:41:38.000Z</published>
    <updated>2020-12-14T02:34:15.534Z</updated>
    
    <content type="html"><![CDATA[<p>本記事はマイクロソフト社員によって公開されております。</p><blockquote><p>本記事は 2018 年 10 月 24 日に <a href="https://docs.microsoft.com/en-us/archive/blogs/askcorejp/firewall-rules-are-not-cleaned-up-on-user-profile-delete">Windows Server 2016 および 2019 における Windows ファイアウォール ルールの肥大化について</a> に公開された記事、および 2019 年 3 月 7 日に <a href="https://social.technet.microsoft.com/Forums/ja-JP/67d19c48-36ad-4a1d-b125-95e266b85f9d/windows-server-2016-123621242412403-2019-12395123621236912427-windows">Windows Server 2016 および 2019 における Windows ファイアウォール ルールの肥大化について</a> に公開された記事の最新版になります。</p></blockquote><p>こんにちは。Windows プラットフォーム サポートの丸山です。</p><p>今回は、Windows Server 2016、Windows Server 2019 および Windows 10  にて UWP アプリケーションに関する Windows ファイアウォールの規則が登録され、肥大化する問題についてご紹介します。</p><h2 id="事象-Symptom"><a href="#事象-Symptom" class="headerlink" title="事象 - Symptom"></a>事象 - Symptom</h2><p>リモート デスクトップ環境など、多くのユーザーが繰り返しログオン、ログオフする環境において、Windows ファイアウォールの規則が大量に登録される、あるいは Windows Notification Framework (WNF) と呼ばれる機能に関するレジストリ値が大量に登録されることにより、以下のような事象が発生することが報告されております。</p><p>この事象は、主に Remote Desktop Service が有効化された Windows Server 2016 環境、Windows Server 2019 環境のほか、VDI として構築された Windows 10 環境でも発生する可能性があります。</p><ul><li>スタート メニューまたは検索ウィンドウ、Cortana を開くことができない</li><li>ログイン時に黒い画面のまま、デスクトップの表示までに時間がかかる</li><li>パフォーマンスの劣化</li><li>サーバーがハング</li><li>Internet Explorer を起動できない</li></ul><p>また、本問題の発生時には、以下のようなイベントが記録されます。</p><blockquote><p>Source: Microsoft-Windows-AppModel-Runtime<br>Date:<br>Event ID: 21<br>Task Category: None<br>Level: Error<br>Keywords: (70368744177664),AppContainer<br>Description: CreateAppContainerProfile failed for AppContainer Microsoft.Windows.ShellExperienceHost_cw5n1h2txyewy with error 0x800705AA.  </p></blockquote><blockquote><p>Source: Microsoft-Windows-AppModel-Runtime<br>Date:<br>Event ID: 21<br>Task Category: None<br>Level: Error<br>Keywords: (70368744177664),AppContainer<br>Description: CreateAppContainerProfile failed for AppContainer Microsoft.Windows.Cortana_cw5n1h2txyewy with error 0x800705AA.  </p></blockquote><p>※ Microsoft-Windows-AppModel-Runtime の ID 21 のイベントが記録され、エラー コードとして、0x800705AA が記録されていることがポイントでございます。</p><h2 id="条件-Condition"><a href="#条件-Condition" class="headerlink" title="条件 - Condition"></a>条件 - Condition</h2><p>ユーザーがログオフするタイミングでユーザー プロファイルが削除され、次回ログオン時にユーザー プロファイルが新規で作成される環境で発生します。特に以下のような環境が該当します。</p><h3 id="パターン-1-移動ユーザー-プロファイルを使用し、且つ以下のポリシーを設定している場合"><a href="#パターン-1-移動ユーザー-プロファイルを使用し、且つ以下のポリシーを設定している場合" class="headerlink" title="パターン 1: 移動ユーザー プロファイルを使用し、且つ以下のポリシーを設定している場合"></a>パターン 1: 移動ユーザー プロファイルを使用し、且つ以下のポリシーを設定している場合</h3><blockquote><p>+ [コンピューターの管理]<br>+ [管理用テンプレート]<br>+ [システム]<br>+ [ユーザー プロファイル]<br>+ [一時記憶された移動プロファイルのコピーを削除する]  </p></blockquote><p>※上記ポリシーが適用されていない場合にも、定期的にプロファイルのキャッシュの削除が行われている環境が該当します。</p><h3 id="パターン-2-Remote-Desktop-Service-環境にて、User-Profile-Disk-を使用している場合"><a href="#パターン-2-Remote-Desktop-Service-環境にて、User-Profile-Disk-を使用している場合" class="headerlink" title="パターン 2 : Remote Desktop Service 環境にて、User Profile Disk を使用している場合"></a>パターン 2 : Remote Desktop Service 環境にて、User Profile Disk を使用している場合</h3><p>User Profile Disk を利用している環境では、ログオフ時にプロファイルの削除が行われませんが、ログオン時に Windows ファイアウォールの規則の登録、WNF に関するレジストリ値の登録が行われます。</p><h2 id="原因-Cause"><a href="#原因-Cause" class="headerlink" title="原因 - Cause"></a>原因 - Cause</h2><p>本事象は、Windows では、ユーザー プロファイルの新規作成時に UWP アプリケーションに関する Windows ファイアウォールの規則の登録、および WNF に関するレジストリ値の登録が行われますが、ユーザー プロファイルの削除時にはそれらの情報が削除されないことにより発生いたします。</p><p>これにより、ログオフ時にユーザー プロファイルが削除される環境では、ログオンの度に UWP アプリケーションに関する情報が重複して追加され、以下のレジストリが肥大化していきます。</p><ul><li>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\RestrictedServices\Configurable\System</li><li>HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\FirewallRules</li><li>HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Notifications</li></ul><h2 id="対処策-Resolution"><a href="#対処策-Resolution" class="headerlink" title="対処策 - Resolution"></a>対処策 - Resolution</h2><p>本件に対処するためには、DeleteUserAppContainersOnLogoff レジストリ値を設定の上、以下の KB 番号よりも新しい、更新プログラムを適用してください。</p><p>また、固定プロファイルをお使いでございます場合には、追加で [一時プロファイルのコピーを削除する] のポリシーを有効にしてください。</p><h3 id="1-DeleteUserAppContainersOnLogoff-レジストリ値の設定について"><a href="#1-DeleteUserAppContainersOnLogoff-レジストリ値の設定について" class="headerlink" title="1. DeleteUserAppContainersOnLogoff レジストリ値の設定について"></a>1. DeleteUserAppContainersOnLogoff レジストリ値の設定について</h3><p>まず最初に、プロファイルの削除時に UWP に関する Windows ファイアウォールの規則が削除されるよう、以下のレジストリ値を設定します。</p><blockquote><p>キー : HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy<br>名前 : DeleteUserAppContainersOnLogoff<br>種類 : REG_DWORD<br>値 : 1 ※ユーザー プロファイル削除時に Windows ファイアウォールの規則を削除します。  </p></blockquote><p>※既に追加され残っている Windows ファイアウォールの規則については次回のログオフに伴うユーザー プロファイル削除時に削除されます。更新プログラムの適用、レジストリ値の追加、再起動だけでは削除されません。</p><h3 id="2-更新プログラムの適用"><a href="#2-更新プログラムの適用" class="headerlink" title="2. 更新プログラムの適用"></a>2. 更新プログラムの適用</h3><p>各 OS バージョン毎に、以下の KB 番号よりも新しい更新プログラムを適用してください。</p><h4 id="Windows-Server-2016-および-Windows-10-Enterprise-LTSC-2016"><a href="#Windows-Server-2016-および-Windows-10-Enterprise-LTSC-2016" class="headerlink" title="Windows Server 2016 および Windows 10 Enterprise LTSC 2016"></a>Windows Server 2016 および Windows 10 Enterprise LTSC 2016</h4><p>DeleteUserAppContainersOnLogoff レジストリ値を設定の上、KB4550947 以降の更新プログラムを適用してください。</p><p>2020 年 4 月 21 日 - KB4550947 (OS ビルド 14393.3659)<br><a href="https://support.microsoft.com/ja-jp/help/4550947/windows-10-update-kb4550947">https://support.microsoft.com/ja-jp/help/4550947/windows-10-update-kb4550947</a></p><p>※過去には、KB4467684 の更新プログラムをご案内しておりましたが、KB4550947 以降の更新プログラムでは、Notifications キー配下のレジストリ値がリークする問題に対する修正が含まれております。</p><h4 id="Windows-10-version-1709"><a href="#Windows-10-version-1709" class="headerlink" title="Windows 10 version 1709"></a>Windows 10 version 1709</h4><p>Windows 10 version 1709 以前の環境につきましては、本件に対する更新プログラムのご用意がございません。Windows 10 version 1903 以降の環境への移行をご検討ください。</p><h4 id="Windows-10-version-1803"><a href="#Windows-10-version-1803" class="headerlink" title="Windows 10 version 1803"></a>Windows 10 version 1803</h4><p>DeleteUserAppContainersOnLogoff レジストリ値を設定の上、KB4493437 以降の更新プログラムを適用することにより、Windows ファイアウォールの規則の肥大化を抑止できますが、WNF に関するレジストリの肥大化を防ぐことは出来ません。Windows 10 version 1903 以降の環境への移行をご検討ください。</p><p>2019 年 4 月 26 日 — KB4493437 (OS ビルド 17134.753)<br><a href="https://support.microsoft.com/ja-jp/help/4493437/windows-10-update-kb4493437">https://support.microsoft.com/ja-jp/help/4493437/windows-10-update-kb4493437</a></p><h4 id="Windows-Server-2019-および-Windows-10-Enterprise-2019-LTSC-および-Windows-10-version-1809"><a href="#Windows-Server-2019-および-Windows-10-Enterprise-2019-LTSC-および-Windows-10-version-1809" class="headerlink" title="Windows Server 2019 および Windows 10 Enterprise 2019 LTSC および Windows 10 version 1809"></a>Windows Server 2019 および Windows 10 Enterprise 2019 LTSC および Windows 10 version 1809</h4><p>DeleteUserAppContainersOnLogoff レジストリ値を設定の上、KB4571748 以降の更新プログラムを適用してください。</p><p>2020 年 8 月 20 日 KB4571748 (OS ビルド 17763.1432) プレビュー<br><a href="https://support.microsoft.com/ja-jp/help/4571748/windows-10-update-kb4571748">https://support.microsoft.com/ja-jp/help/4571748/windows-10-update-kb4571748</a></p><p>※過去には、KB4490481 の更新プログラムをご案内しておりましたが、KB4550969 以降の更新プログラムでは、Notifications キー配下のレジストリ値がリークする問題に対する修正が含まれております。</p><p>※また、KB4571748 以降の更新プログラムでは、固定プロファイル環境下において Notifications キー配下のレジストリ値がリークする問題に対する修正が含まれております。</p><h4 id="Windows-10-version-1903-および-Windows-10-version-1909"><a href="#Windows-10-version-1903-および-Windows-10-version-1909" class="headerlink" title="Windows 10 version 1903 および Windows 10 version 1909"></a>Windows 10 version 1903 および Windows 10 version 1909</h4><p>DeleteUserAppContainersOnLogoff レジストリ値を設定の上、KB4559004 以降の更新プログラムを適用してください。</p><p>2020 年 7 月 21 日—KB4559004 (OS ビルド 18362.997 および 18363.997) プレビュー<br><a href="https://support.microsoft.com/ja-jp/help/4559004/windows-10-update-kb4559004">https://support.microsoft.com/ja-jp/help/4559004/windows-10-update-kb4559004</a></p><h4 id="Windows-10-version-2004-および-Windows-10-version-20H2"><a href="#Windows-10-version-2004-および-Windows-10-version-20H2" class="headerlink" title="Windows 10 version 2004 および Windows 10 version 20H2"></a>Windows 10 version 2004 および Windows 10 version 20H2</h4><p>製品出荷時より修正が含まれておりますので、更新プログラムの適用は不要でございます。DeleteUserAppContainersOnLogoff レジストリ値を設定してください。</p><h3 id="3-一時プロファイルのコピーを削除する-のポリシーを有効にする"><a href="#3-一時プロファイルのコピーを削除する-のポリシーを有効にする" class="headerlink" title="3. [一時プロファイルのコピーを削除する] のポリシーを有効にする"></a>3. [一時プロファイルのコピーを削除する] のポリシーを有効にする</h3><p>固定プロファイルをお使いでございます場合には、追加で [一時プロファイルのコピーを削除する] のポリシーを有効にしてください。</p><blockquote><p>+ [コンピューターの管理]<br>+ [管理用テンプレート]<br>+ [システム]<br>+ [ユーザー プロファイル]<br>+ [一時記憶された移動プロファイルのコピーを削除する]  </p></blockquote><p>※固定プロファイルをお使いではない場合、本手順はスキップ可能です。</p><h3 id="4-すでにリークしてしまった-Notifications-キー配下のレジストリ値の削除について"><a href="#4-すでにリークしてしまった-Notifications-キー配下のレジストリ値の削除について" class="headerlink" title="4. すでにリークしてしまった Notifications キー配下のレジストリ値の削除について"></a>4. すでにリークしてしまった Notifications キー配下のレジストリ値の削除について</h3><p>DeleteUserAppContainersOnLogoff レジストリ値を設定の上、記載の更新プログラムを適用しましても、更新プログラムの適用よりも前にリークしてしまった Notifications キー配下のレジストリ値の削除は行われません。</p><p>更新プログラムを適用するよりも前に、Notifications キー配下のレジストリ情報の肥大化が発生しております場合には、Notifications キー配下の値を削除のうえ、コンピューターを再起動することで状況が改善されますかどうか、ご確認ください。</p><p>※多数のレジストリ値が登録されており、レジストリ エディターで上記のキーを開くことが出来ない場合には、[管理者として実行] されたコマンド プロンプトから以下のコマンドを実行して、Notifications キー配下の値を削除してください。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG DELETE &quot;HKLM\Software\Microsoft\Windows NT\CurrentVersion\Notifications&quot; &#x2F;VA  </span><br></pre></td></tr></table></figure><h4 id="Windows-Server-2016-および-Windows-10-Enterprise-LTSC-2016-における注意事項について"><a href="#Windows-Server-2016-および-Windows-10-Enterprise-LTSC-2016-における注意事項について" class="headerlink" title="Windows Server 2016 および Windows 10 Enterprise LTSC 2016 における注意事項について"></a>Windows Server 2016 および Windows 10 Enterprise LTSC 2016 における注意事項について</h4><p>Windows Server 2016 および Windows 10 Enterprise 2016 LTSB 環境では、Notifications キー配下の値を削除しますと、ローカル プロファイルが残されているユーザーにおいてスタート ボタンが効かなくなる問題が確認されております。</p><p>Notifications キー配下の値の削除により、スタート メニューが開けなくなってしまったユーザーにおきましては、プロファイルを再作成するか、各ユーザー権限にて以下のコマンドを実行し、復旧してください。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tdlrecover.exe -reregister</span><br></pre></td></tr></table></figure><h4 id="Windows-Server-2019-および-Windows-10-Enterprise-2019-LTSC-および-Windows-10-version-1803-以降の環境における注意事項について"><a href="#Windows-Server-2019-および-Windows-10-Enterprise-2019-LTSC-および-Windows-10-version-1803-以降の環境における注意事項について" class="headerlink" title="Windows Server 2019 および Windows 10 Enterprise 2019 LTSC および Windows 10 version 1803 以降の環境における注意事項について"></a>Windows Server 2019 および Windows 10 Enterprise 2019 LTSC および Windows 10 version 1803 以降の環境における注意事項について</h4><p>Windows Server 2019 および Windows 10 Enterprise 2019 LTSC および Windows 10 version 1803 以降の環境では、Notifications キー配下にある、Data キー配下の値を削除してしまいますと、タスク スケジューラに登録されているタスクが実行されなくなることがある問題が確認されております。</p><p>Data キー配下の値の削除により、タスク スケジューラに登録されているタスクが実行されなくなってしまった環境におきましては、管理者として実行されたコマンドプロンプトより以下のコマンドを実行し、対処してください。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">REG ADD &quot;HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Notifications\Data&quot; &#x2F;V 41960B29A3BC0C75 &#x2F;T REG_BINARY &#x2F;D 0300000001000000  </span><br></pre></td></tr></table></figure><h3 id="5-更新プログラムの適用が出来ない場合-Workaround"><a href="#5-更新プログラムの適用が出来ない場合-Workaround" class="headerlink" title="5. 更新プログラムの適用が出来ない場合 - Workaround"></a>5. 更新プログラムの適用が出来ない場合 - Workaround</h3><p>更新プログラムの適用が出来ない場合や、Windows ファイアウォールに多数の規則が追加されており、ログオン、ログオフによる対処が難しい状況でございます場合には、以下手順の実施をご検討ください。</p><ol><li>正常に動いている同一構成の環境にて、Windows ファイアウォールの規則をエクスポートします。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall export [ファイルの配置先]\[ファイル名]</span><br></pre></td></tr></table></figure><p>コマンド例:  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall export \\server\share\firewall.wfw</span><br></pre></td></tr></table></figure><ol start="2"><li>問題が起きている環境にて、以下のコマンドを実行し、レジストリ値を削除します。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">REG DELETE &quot;HKEY_LOCAL_MACHINE\Software\Microsoft\Windows NT\CurrentVersion\Notifications&quot; &#x2F;VA  </span><br><span class="line">REG DELETE &quot;HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\FirewallRules&quot; &#x2F;VA  </span><br><span class="line">REG DELETE &quot;HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\RestrictedServices\Configurable\System&quot; &#x2F;VA  </span><br></pre></td></tr></table></figure><ol start="3"><li>問題が起きている環境にて、コンピューターを再起動します。</li><li>問題が起きている環境にて、正常な環境からエクスポートした Windows ファイアウォールの規則をインポートします。</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall import [ファイルの配置先]\[ファイル名]</span><br></pre></td></tr></table></figure><p>コマンド例:  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netsh advfirewall import \\server\share\firewall.wfw</span><br></pre></td></tr></table></figure><p>また本問題は、Windows 8.1 や Windows Server 2012 R2 にてストア アプリを利用している場合にも発生する可能性があります。Windows 8.1 あるいは Windows Server 2012 R2 環境において本問題と思われる事象が発生した場合には、本手順を実施いただき、事象が改善されるかどうかをご確認ください。</p><h2 id="更新履歴-Update-History"><a href="#更新履歴-Update-History" class="headerlink" title="更新履歴 - Update History"></a>更新履歴 - Update History</h2><ul><li>2018/10/24 : 本 Blog の公開</li><li>2018/10/31 : Windows Server 2019 についても追記</li><li>2018/11/29 : Windows Server 2016 の更新プログラム追加によるResolutionを記載しました。</li><li>2019/07/05 : 対処方法について一部追加</li><li>2019/07/17 : 対処方法について一部追加</li><li>2020/04/22 : 対処方法について一部追加</li><li>2020/10/08 : 対処方法について一部追加、体裁の見直しなど</li><li>2020/11/13 : 対処方法について一部追加</li></ul>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;本記事はマイクロソフト社員によって公開されております。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;本記事は 2018 年 10 月 24 日に &lt;a href=&quot;https://docs.microsoft.com/en-us/archive/blogs/askcorejp/</summary>
      
    
    
    
    <category term="Remote Desktop" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/"/>
    
    <category term="Remote Desktop Service (RDS)" scheme="https://jpwinsup.github.io/blog/categories/Remote-Desktop/Remote-Desktop-Service-RDS/"/>
    
    
  </entry>
  
</feed>
